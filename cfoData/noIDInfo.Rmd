---
title: "April, 2017 - July 2017 Stats"
author: "Martin Gleason, MS"
date: '`r format(Sys.time(), "%B %d, %Y")`'
tables: yes
output:
  pdf_document:
    fig_caption: yes
urlcolor: blue

header-includes:
- \usepackage{color}
- \usepackage{float}
---
```{r, required files, include = F, echo = F}
source("/Users/marty/Dropbox (Personal)/codingProjects/cfoData/april_julyCFO.R")

options(knitr.table.format = "latex")
opts_chunk$set(fig.pos = "h")
```
# Purpose
This document is to summarize the last three months of CFO data, including: Attendance policy, attendance numbers, referrals, JEMS issues, tracking and storing data, and data transformation. A way forward with CFOs will also be presented. While some of the tables maybe be difficult to read, thanks to the magic of PDF formats, any reader should be able to zoom into items of note.

# Attendance
Critical to the continued success of the CFO is getting the attendance rate over 50%. Traditional JAC Orientation programming reached a cap of approximately 50%, with attendance numbers typically hovering between 20%-30%.

## Attendance Policy
A carry over from traditional JAC programming, young people are being referred to a CFO three times before not being eligible for the program. Where as traditional orientations did not have a referral process, CFOs do have a series of protocols inplace, including:

* Paper referrals that are given to each unit involved in CFO Programming
* Montly lists (generated from JEMS based Excel Spreadsheets) are given to SPOs of each unit
* Personalized form letters mailed between 5-10 days before a CFO
  + A copy of this letter is also given to POs
  + The letter's verbage reflects the more inclusive tone of the CFO, including "encouraging young people to attend" and their PO's last name as a person to contact if they cannot make the CFO
* Phone calls 12-38 hours before a CFO
  + All phone calls are documented in JEMS
* Attendance is recorded on paper and in JEMS
  + JEMS notes are typically entered within one week of a CFO
  + This is more challenging than expected, but it will be explored further in the JEMS section
  

## Attendance Numbers
Getting these numbers is problematic for a variety of reasons, not the least of which because JEMS does not accuately track or export attendance numbers. To get numbers of this particular report, the following was done:

1. JEMS exported Excel tables were comibined into one table
2. Duplicate JEMS ID were removed
3. A new column, "Attendance" was added.
\newpage

### Table
The first ten youth from that table are as follows

```{r, eval=FALSE}
april_july_CFO_attendance <- april_july_CFO_attendance %>% arrange(LNAME)

kable(head(april_july_CFO_attendance, n =10), caption = "First 10 CFO Youth in Alphabetical Order") %>%
  kable_styling(latex_options = c("striped", "scale_down", "hold_position"))
```
_this is where i would show how we don't clean data. This first table illustrates some of the difficulties with the JEMS Data. Despite being precleaned in Excel, some errors remain. For example, this record_


is duplicated, which inflates the number of youth counted by Excel. 

While the table looks like it has *`r april_july_CFO_attendance %>% filter(CFO == "Y") %>% nrow()`*young people who were invited to CFOs, the actual number is `r true_invited`, a 10% difference in who was invited to attend the progam. 

A 10% difference can make or break a program";"however, there is an even more difficult issue. 
Given that the bulk of the work on CFO attendance is done in Excel, these duplicate entries are also inflating attendance records. Fixing these errors will be detailed in another section of this report.

### Additional Analysis
Previously, a series of stats were presented inidicating attendance rates of the program. These numbers were painstakingly generated by handcounting rows of printed excel tables. By loading this data into a different program, more cleaning, counting, and analysis can take place. For example, the attendance records can be broken into three distinct representations an aggregrate, disagregated by zip code, and a bar chart.

```{r, attendance numbers, echo = F, include = T}
kable(invited %>% 
    group_by(Attended) %>%
    summarise(Attendnace_Number = n()),
    caption = "Attendance of youth (aggregate)") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```
\newpage
```{r, attendane by zip, echo = F, include = T}
kable(invited %>% 
     group_by(ZIP, Attended) %>%
     summarise(attendance_record = n()),
     caption = "Attendance of youth, by Zipcode") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```
\newpage
```{r, attendance histogram, echo = F, include = T, fig.cap="Attendance by Zip", fig.pos="H"}
viridis_zip_plot
```

With a few lines of code, two tables and a graph were drawn to show how many young people have attended CFOs since April, 2017. This analysis also indicates two issues.

1. The attendance catagories of _`r unique(invited$Attended)`_ need clarification. Switching to numbers will improve clarity and analysis.

2. Some referrals do not have an assigned gender. This is due to human error, as JEMS only allows for a binary Male or Female category.

This data can be cleaned further, but it does point out some trends. Of the `r true_invited` youth invited to attend a CFO since April, only 27 attended, a ratio of `r scales::percent(27/true_invited)`. We can break this down further by zipcode.
\newpage
```{r, attendance by zip, echo = F, include = T}
kable(zip_sex_attendance %>% 
        left_join(invited_by_zip) %>%
        mutate(proportion = scales::percent(Attendence_Count/youth_per_zip)) %>%
        select(-5),
      caption = "Attendance per Zip, by Gender") %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"))
```

This data is the same as figure 1, and while tabular nature may make it more understandable to, the sheer amount of information is overwhelming. Drilling down further, we can see which zipcodes have the best historic performance

```{r, best performance, echo = F, include = T}
kable(zip_sex_attendance %>% 
        left_join(invited_by_zip) %>%
        mutate(p = scales::percent(Attendence_Count/youth_per_zip)) %>%
        filter(Attended == "y") %>%
        select(-5),
        #summarise(max_percent = max(p)) %>%
        #ungroup()  %>%
        #group_by(SEX) %>%
        #arrange(desc(max_percent)),
      caption = "Best Attendance per Zip, by Gender") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```
_As well as the worst_
```{r, eval=FALSE, include=FALSE, worst, echo=F}
kable(zip_sex_attendance %>% 
        left_join(invited_by_zip) %>%
        mutate(p = scales::percent(Attendence_Count/youth_per_zip)) %>%
        select(-5), 
        #filter(Attended == "n"), #%>%
        #summarise(max_percent = min(p)) %>%
        #ungroup()  %>%
        #group_by(SEX) %>%
        #arrange(max_percent),
      caption = "Worst Attendance per Zip, by Gender") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

## Choropleth for Context
Drilling into the numbers by tables and graphs certainly helps paint the picture of who is, and is not, attending the CFOs. What is lacking is why the numbers are so low. Part of the lackluster may have to do with the neighborhoods of Chicago. It is possible to map the young people's addresses on file, with their attendance records. This may shed additional light on the attendance figures. Adding interactive (zoom-able) maps into a PDF is more difficult than initially estimated. But as of this writing, it is possible to plot referral addresses on a map of Chicago.

```{r, choropleth, echo = F, include = T, fig.pos = "H", fig.cap = "Area of CFO Referrals: Chicago"}

cfo_map

```
