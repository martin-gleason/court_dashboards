---
title: "April, 2017 - July 2017 Stats"
author: "Martin Gleason, MS"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output:
  pdf_document:
    fig_caption: yes
  html_notebook: default
  html_document: default
tables: yes
header-includes:
- \usepackage{color}
- \usepackage{float}
urlcolor: blue
---
```{r, required files, include = F, echo = F}
source("/Users/marty/Dropbox (Personal)/codingProjects/cfoData/april_julyCFO.R")

options(knitr.table.format = "latex")
opts_chunk$set(fig.pos = "h")
opts_chunk$set(message = F)
opts_chunk$set(warning = F)
```
# Purpose
This document is to summarize the last three months of CFO data, including: Attendance policy, attendance numbers, referrals, JEMS issues, tracking and storing data, and data transformation. A way forward with CFOs will also be presented. While some of the tables maybe be difficult to read, thanks to the magic of PDF formats, any reader should be able to zoom into items of note. If the department wants to explore using R for stat and report generation, future editions of reports will be able to have interactive graphs.

# Attendance
Critical to the continued success of the CFO is getting the attendance rate over 50%. Traditional JAC Orientation programming reached a cap of approximately 50%, with attendance numbers typically hovering between 25%-40%.

# Attendance Policy
A carry over from traditional JAC programming, young people are being referred to a CFO three times before not being eligible for the program. Where as traditional orientations did not have a referral process, CFOs do have a series of protocols inplace, including:

* Paper referrals that are given to each unit involved in CFO Programming
* Montly lists (generated from JEMS based Excel Spreadsheets) are given to SPOs of each unit
* Personalized form letters mailed between 5-10 days before a CFO
  + A copy of this letter is also given to POs 
  + The letter's verbage reflects the more inclusive tone of the CFO, including "encouraging young people to attend" and their PO's last name as a person to contact if they cannot make the CFO
* Phone calls 12-38 hours before a CFO
  + All phone calls are documented in JEMS
* Attendance is recorded on paper and in JEMS
  + JEMS notes are typically entered within one week of a CFO
  + Excel is not consistently used to indicate attedance
  + This is more challenging than expected, but it will be explored further in the JEMS section
  
\newpage  
## Attendance Numbers
Getting these numbers is problematic for a variety of reasons, not the least of which because JEMS does not track or export attendance numbers. To get numbers of this particular report, the following was done:

1. JEMS exported 3 Excel tables
2. A new column, "Attendance" was added.
3. Paper records were consulted for determining attendance
4. Duplicate JEMS ID were removed through an Excel function

\newpage
###What the data indicates
The first ten youth from the new table are as follows

```{r, numbers tables, include = T, echo = F}
april_july_CFO_attendance <- april_july_CFO_attendance %>% arrange(LNAME)

kable(head(april_july_CFO_attendance, n = 10), caption = "First 10 CFO Youth in Alphabetical Order", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "hold_position"))
```
This first table illustrates some of the difficulties with the JEMS Data. Despite being precleaned in Excel, some errors remain. For example, this record 

```{r, xa, include = T, echo = F}
kable(april_july_CFO_attendance %>% filter(FNAME == "XAVIER" & LNAME == "ALLEN"), 
      caption = "First Duplicate Youth", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "hold_position"))
```
is duplicated, which inflates the number of youth counted by Excel. 

While the table looks like it has *`r april_july_CFO_attendance %>% filter(CFO == "Y") %>% nrow()`* young people who were invited to CFOs, the actual number is _`r true_invited`_, a 10% difference in who was invited to attend the progam.   

A 10% difference can make or break a program; however, there is an even more difficult issue. 
Given that the bulk of the work on CFO attendance is done in Excel, these duplicate entries are also inflating attendance records. Fixing these duplication errors will be detailed in another section of this report.
\newpage

### Additional Analysis
Earlier this month, the PYD unit was asked to to compile a series of stats inidicating attendance rates in CFOs. These numbers were painstakingly generated by handcounting rows of printed Excel tables. By loading this data into a different program, more cleaning, counting, and analysis can take place. For example, the attendance records can be broken into three distinct representations an aggregrate, disagregated by zip code, and a bar chart.

```{r, attendance numbers, echo = F, include = T}
kable(invited %>% 
    group_by(Attended) %>%
    summarise(Attendnace_Number = n()),
    caption = "Attendance of youth (aggregate)",
    booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

```{r, attendane by zip, echo = F, include = T}
kable(invited %>% 
     group_by(ZIP, Attended) %>%
     summarise(attendance_record = n()),
     caption = "Attendance of youth, by Zipcode",
     booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```
\newpage


With a few lines of code, two tables and a graph were drawn to show how many young people have attended CFOs since April, 2017. This analysis also indicates two issues.

1. The attendance catagories of _`r unique(invited$Attended)`_ need clarification. Switching to numbers will improve clarity and analysis.

2. Some referrals do not have an assigned gender. This is due to human error, as these rerrals appear to be added manaully to the attednace charts. 
  + JEMS needs to be updated to track non-binary youth.

Exploring the data reveals that it needs to be cleaned further. Even this raw table points out some key trends in CFO attendance. but it does point out some trends. Of the *`r true_invited`* youth invited to attend a CFO since April, only 27 attended, a ratio of *`r scales::percent(27/true_invited)`*. These attendance stats can be broken down further by zipcode.

\newpage
```{r, attendance by zip, echo = F, include = T}
kable(zip_sex_attendance %>% 
        left_join(invited_by_zip) %>%
        mutate(proportion = scales::percent(Attendence_Count/youth_per_zip)) %>%
        select(-5),
      caption = "Attendance per Zip, by Gender",
      booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"))
```

This data is the same as figure 1, and while tabular nature may make it more understandable for some, the sheer amount of information is overwhelming. The tables can be seperated into smaller chunks for easier understanding. For example, we can see which zipcodes have the best historic performance

```{r, best performance, echo = F, include = T}
zipArranged <-  zip_sex_attendance %>% 
      left_join(invited_by_zip) %>%
      mutate(p = (Attendence_Count/youth_per_zip)) %>%
      filter(Attended == "y") %>%
      select(-5) %>%
      summarise(max_percent = max(p)) %>%
     arrange(desc(max_percent))
kable(zipArranged,
      caption = "Best Attendance per Zip, by Gender",
      booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position", "right_justified"))
```

As well as the worst

```{r, eval=FALSE, include=FALSE, worst, echo=F}
kable(zip_sex_attendance %>% 
        left_join(invited_by_zip) %>%
        mutate(p = (Attendence_Count/youth_per_zip)) %>%
        filter(Attended == "y") %>%
        select(-5) %>%
        summarise(max_percent = max(p)) %>%
        arrange((max_percent))
      caption = "Worst Attendance per Zip, by Gender",
      booktabs = T) %>%
  kable_styling(latex_options = c("striped", "hold_position", "left_justified"))
```

\newpage
### Choropleth for Context
Drilling into the numbers by tables and graphs certainly helps paint the picture of who is, and is not, attending the CFOs. What is lacking is why the numbers are so low. Part of the lackluster attendance may have to do with the neighborhoods of Chicago. It is possible to map the young people's addresses on file, with their attendance records. This may shed additional light on the attendance figures. Adding interactive (zoom-able) maps into a PDF is more difficult than initially estimated. But as of this writing, it is possible to plot referral addresses on a map of Chicago.


It is also possible to add layers to the referral map. For example, we can pull crime data from the [City of Chicago](https://data.cityofchicago.org/Public-Safety/) and overlay that information on the referrals to see how our young people are affectd by violence in their communities. 


This map shows the density of crime thoughout Chicago. The more lines indicate a higher desinity of crime. The data does have a total of 31 catagories of crime, and could be refined further to showcase violent crimes, property crimes, or drug-releated crimes. Geographic information can help further identify some of the difficulties young people have in attending CFO programming. Additional understanding of neighborhood condidtions will 
\newpage

#Referals
The statistiscs indicate that young men from _SPO Alejo's unit and young women from TK's unit have the highest levels of attendance, where as young men from SPO Moore's and SPO Jouras' units are the lowest._ While the factors that play into these numbers differ by unit, some of them appear to be:

* Unit buy-in
 + While all POs appear supportive, PO's in _Adrian's_ unit remind young people of appointments and have transported young people to the program
 
*   

#JEMS 

#Tracking and Storing Data

#Data Transformation

#Summary

